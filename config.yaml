# OnWatch Automation Configuration
# Complete baseline data from machine 10.1.25.90
#
# This configuration file defines all data that will be populated on the OnWatch system.
# All paths are relative to the project root unless specified as absolute paths.
# After running the automation, an output YAML file will be generated for validation.

# OnWatch API Connection
# Required: All fields must be configured for the automation to work
onwatch:
  ip_address: "10.1.71.16"
  username: "Administrator"
  password: "pa$$word!"
  base_url: "https://10.1.71.16"
  # OnWatch version: "2.6" or "2.8" (optional - will auto-detect if not specified)
  # version: "2.6"  # Uncomment and set if auto-detection fails

# SSH Configuration (for translation file upload)
ssh:
  ip_address: "10.1.71.16"  # Usually same as onwatch IP
  username: "user"  # SSH user (will sudo to root for translation-util)
  password: "user1!"  # SSH password (default for user "user")
  sudo_password: "user1!"  # Sudo password (if different from SSH password, leave empty to use SSH password)
  # Path to translation-util script on the device
  translation_util_path: "/opt/ansible-installer-1.4.0-8/support-scripts/translation-util"

rancher:
  ip_address: "10.1.25.90"
  port: 9443
  username: "admin"
  password: "admin"
  base_url: "https://10.1.71.16:9443"
  # Workload URL path (relative to base_url) - update workloadId if needed
  # Format: /p/local:p-p6l45/workloads/run?launchConfigIndex=-1&namespaceId=default&upgrade=true&workloadId=statefulset%3Adefault%3Acv-engine
  workload_path: "/p/local:p-p6l45/workloads/run?launchConfigIndex=-1&namespaceId=default&upgrade=true&workloadId=statefulset%3Adefault%3Acv-engine"

# KV Parameters (Key-Value Settings)
# These are application-level settings stored as key-value pairs.
# All parameters will be validated after population.
kv_parameters:
  "applicationSettings/watchVideo/secondsAfterDetection": 6
  "applicationSettings/watchVideo/secondsBeforeDetection": 6
  "applicationSettings/defaultFaceThreshold": 0.6
  "applicationSettings/maskClassifier/threshold": 0.7
  "DEFAULT/collate-service/TRACKS_RETENTION_TIME_MS": 80000

# System Settings
# Comprehensive system configuration including thresholds, retention periods, and UI customization.
# All settings will be validated after population.
system_settings:
  general:
    blur_all_faces_except_selected: false
    discard_detections_not_in_watch_list: false
    body_image_retention_period: "13h"
    default_body_threshold: 0.61
    default_liveness_threshold: 0.55
  
  map:
    seed_location:
      lat: 34.01993376317111
      long: -118.50479101075484
    acknowledge: true
    action_title: "call the police"
    masks_access_control: false
  
  system_interface:
    translation_file: "assets/Polski-updated3.json"  # Path to translation file (relative to project root)
    product_name: "metropolis"
    # Logo and favicon configuration
    # Paths are relative to project root, or absolute paths
    logos:
      company: "assets/images/me.jpg"  # Company logo (displayed in top-left of UI)
      sidebar: "assets/images/me.jpg"  # Sidebar logo (displayed in navigation sidebar)
    favicon: "assets/images/favicon.ico"  # Browser favicon (displayed in browser tab)
  
  engine:
    video_storage:
      all_videos_days: 6
      videos_with_detections_days: 6
    detection_storage_days: 8
    alert_storage_days: 9
    inquiry_storage_days: 8

# Environment Variables (set via Rancher/Kubernetes)
# These are set in the cv-engine workload via Rancher API.
# All environment variables will be validated after population.
env_vars:
  ENABLE_DVR: "True"
  OVERWRITE_FFMPEG_OPTIONS_VALUES: "ffmpeg-opts:rtsp_transport=udp,reorder_queue_size=8192,max_delay=500000,buffer_size=4194304"
  SERVICE_TAGS: "engine-service,body-from-face-pipeline,body-pipeline,dvr,face-pipeline,ffmpeg-options,forensics,gdpr,image-processing,live-stream,roi,watch-video,webrtc"
  SERVICE_DOMAIN: "cv-engine.default"
  CUDA_DEVICE_ORDER: "PCI_BUS_ID"

# Device/Camera Settings
# Each device/camera will be created with the specified configuration.
# All cameras will be validated after population (existence check).
devices:
  - name: "face camera"
    video_url: "rtsp://10.1.70.16:8554/Faces720"
    details:
      threshold: 0.5
      location:
        name: "holon"
        long: 34.800
        lat: 32.007
    calibration:
      tracker: 4
      face_track_length:
        min: 0.5
        max: 11
      calibration_tool:
        padding:
          top: 130
          right: 1768
          bottom: 1060
          left: 201
        detection_min_size: 48
    security_access:
      liveness: true
      liveness_threshold: 0.6
  
  - name: "face camera 2"
    video_url: "rtsp://10.1.70.16:8554/Faces720"
    details:
      threshold: 0.61
      location:
        name: "default"
    calibration:
      tracker: 3
      face_track_length:
        min: 0.2
        max: 10
      calibration_tool:
        padding:
          top: 0
          right: 0
          bottom: 0
          left: 0
        detection_min_size: 48
    security_access:
      liveness: true
      liveness_threshold: 0.55
  
  - name: "Moderate-from-streamer"
    video_url: "rtsp://10.1.70.16:8554/moderate_4_2h"
    details:
      threshold: 0.61
      location:
        name: "default"
    calibration:
      tracker: 3
      face_track_length:
        min: 0.2
        max: 10
      calibration_tool:
        padding:
          top: 0
          right: 0
          bottom: 0
          left: 0
        detection_min_size: 48
    security_access:
      liveness: false
  
  - name: "body camera"
    video_url: "rtsp://service:AnyVision1!@10.1.50.103"
    details:
      threshold: 0.3
      location:
        name: "London"
    calibration:
      tracker: 3
      face_track_length:
        min: 0.2
        max: 10
      calibration_tool:
        padding:
          top: 0
          right: 0
          bottom: 0
          left: 0
        detection_min_size: 20
    security_access:
      liveness: false

# Groups and Profiles
# Subject groups define authorization and visibility rules for watch list subjects.
# Device groups organize cameras (currently not fully utilized in automation).
# All groups will be validated after population.
groups:
  subject_groups:
    - name: "OnPatrol subject"
      authorization: "Always Unauthorized"
      visibility: "Silent"
      priority: 1
    - name: "Cardholders"
      authorization: "Always Authorized"
      visibility: "Visible"
      priority: 2
    - name: "Default Group"
      authorization: "Always Unauthorized"
      visibility: "Silent"
      priority: 0
  
  device_groups:
    - name: "test device group"
      priority: 0
      description: "asdasd"
    - name: "default device group"
      priority: 3
      description: "none"
  

# Account Management
# User accounts and user groups define access control.
# All users will be validated after population (existence check).
# Note: Passwords are only set for new users (null means keep existing password).
accounts:
  users:
    - username: "Test"
      first_name: "test"
      last_name: "test"
      email: "test@test.com"
      role: "operator"
      user_group: "full data group"
      api_key: null
      password: "Test123123!"
    - username: "Administrator"
      first_name: "admin"
      last_name: "admin"
      email: null
      role: "super admin"
      user_group: "full data group"
      api_key: null
      password: null  # Keep existing password
  
  user_groups:
    - title: "testUser group"
      subject_groups: []  # List of subject group names to assign
      camera_groups: []  # List of camera group names to assign (not yet implemented)
    - title: "Full Data Group"
      subject_groups: []  # List of subject group names to assign
      camera_groups: []  # List of camera group names to assign (not yet implemented)

# Inquiries (Forensic Analysis Cases)
# Inquiry cases with video/image files for analysis.
# All inquiry cases will be validated after population (existence check).
inquiries:
  - name: "upgrade test"
    files:
      - path: "assets/videos/Neo.mp4"
        settings: "DEFAULT VALUES"
      - path: "assets/videos/Neo.webm"
        settings:
          type: "custom"  # Use custom ROI and threshold instead of defaults
          threshold: 0.37  # Detection threshold for this file
          roi:  # Region of Interest (camera padding)
            top: 15
            right: 15
            bottom: 22
            left: 0
      - path: "assets/videos/regular_avi_1.avi"
        settings: "DEFAULT VALUES"
      - path: "assets/videos/regular_avi_2.avi"
        settings: "DEFAULT VALUES"
    priority: "Medium"

# Mass Import
# Bulk import of subjects from a tar file.
# The mass import will be validated after population (existence check by ID).
mass_import:
  name: "mass-import 43"
  file_path: "assets/mass-import/mass-import-43.tar"

# Watch List
# Subjects to be added to the watch list with their images.
# All subjects will be validated after population (existence and image count check).
watch_list:
  subjects:
    - name: "Yonatan"
      images:
        - path: "assets/images/me.jpg"
        - path: "assets/images/me2.jpg"
      group: "Default Group"
    
    - name: "crop 1"
      images:
        - path: "assets/images/Crop 1.jpg"
      group: "Default Group"
    
    - name: "crop 2"
      images:
        - path: "assets/images/Crop 2.jpg"
      group: "Default Group"
    
    - name: "women 1"
      images:
        - path: "assets/images/A05131_2025-02-02T14_45_36.jpg"
      group: "Default Group"
    
    - name: "moderate 1"
      images:
        - path: "assets/images/image (3).jpg"
      group: "Default Group"
